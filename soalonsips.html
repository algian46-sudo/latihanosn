<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Quiz Ekonomi & Geografi</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4f46e5;
            --secondary: #6366f1;
            --success: #10b981;
            --danger: #ef4444;
            --bg: #f8fafc;
            --text-dark: #1e293b;
            --card-bg: #ffffff;
        }

        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background-color: var(--bg); 
            color: var(--text-dark);
            margin: 0; padding: 20px;
            line-height: 1.6;
        }

        .container { max-width: 850px; margin: 0 auto; }

        /* Card Style */
        .card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 25px -5px rgba(0,0,0,0.05);
            margin-bottom: 25px;
            border: 1px solid #e2e8f0;
        }

        h1 { text-align: center; color: var(--primary); font-size: 2rem; margin-bottom: 10px; }
        .subtitle { text-align: center; color: #64748b; margin-bottom: 30px; }

        /* Identity Form */
        .identity-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 20px;
            background: #f1f5f9; padding: 20px; border-radius: 12px; margin-bottom: 30px;
        }

        .input-group label { display: block; font-weight: 600; margin-bottom: 8px; font-size: 0.9rem; }
        input[type="text"] {
            width: 100%; padding: 12px; border: 1px solid #cbd5e1; border-radius: 8px;
            box-sizing: border-box; font-size: 1rem; transition: 0.3s;
        }
        input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1); }

        /* Questions */
        .question-item { margin-bottom: 30px; padding-bottom: 20px; border-bottom: 1px solid #f1f5f9; }
        .question-text { font-weight: 700; font-size: 1.05rem; display: block; margin-bottom: 15px; color: #334155; }
        
        .options-grid { display: grid; grid-template-columns: 1fr; gap: 10px; }
        .option-card {
            display: flex; align-items: center; padding: 12px 15px; border: 1.5px solid #e2e8f0;
            border-radius: 10px; cursor: pointer; transition: all 0.2s ease;
        }
        .option-card:hover { border-color: var(--primary); background: #f5f3ff; }
        input[type="radio"] { margin-right: 12px; width: 18px; height: 18px; accent-color: var(--primary); }

        /* Buttons */
        .btn {
            background: var(--primary); color: white; border: none; padding: 16px;
            border-radius: 12px; width: 100%; font-size: 1.1rem; font-weight: 700;
            cursor: pointer; transition: 0.3s; margin-top: 10px;
        }
        .btn:hover { background: #4338ca; transform: translateY(-2px); }
        .btn:disabled { background: #94a3b8; cursor: not-allowed; }

        /* Leaderboard Table */
        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { background: #f8fafc; text-align: left; padding: 12px; color: #64748b; font-size: 0.85rem; text-transform: uppercase; border-bottom: 2px solid #e2e8f0; }
        td { padding: 15px 12px; border-bottom: 1px solid #f1f5f9; font-size: 0.95rem; }
        .rank { font-weight: 700; color: var(--primary); }
        .score-badge { background: #dcfce7; color: #166534; padding: 4px 12px; border-radius: 99px; font-weight: 700; }

        #result-section { display: none; text-align: center; }
        .score-big { font-size: 4rem; font-weight: 800; color: var(--success); margin: 10px 0; }
        
        #loading-overlay { text-align: center; padding: 20px; color: var(--primary); font-weight: 600; }

        @media (max-width: 600px) { .identity-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="container">
    <div class="card" id="quiz-card">
        <h1>Ujian IPS Terpadu</h1>
        <p class="subtitle">Ekonomi Dasar & Interaksi Keruangan</p>

        <div class="identity-grid">
            <div class="input-group">
                <label>Nama Lengkap</label>
                <input type="text" id="nama" placeholder="Budi Santoso...">
            </div>
            <div class="input-group">
                <label>Kelas</label>
                <input type="text" id="kelas" placeholder="VII - A...">
            </div>
        </div>

        <div id="quiz-container">
            </div>

        <button class="btn" id="submit-btn" onclick="submitExam()">Kirim Semua Jawaban</button>
    </div>

    <div class="card" id="result-section">
        <h2>Ujian Selesai!</h2>
        <p id="student-res-info"></p>
        <div class="score-big" id="final-score">0</div>
        <p style="color: #64748b;">Data Anda telah tersimpan di Google Sheets.</p>
        <button class="btn" onclick="location.reload()" style="background:#64748b;">Kerjakan Ulang</button>
    </div>

    <div class="card">
        <h2 style="margin-top:0;">Papan Skor Live (Real-time)</h2>
        <div id="loading-overlay">Menghubungkan ke database...</div>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Pos</th>
                        <th>Nama Siswa</th>
                        <th>Kelas</th>
                        <th>Nilai</th>
                    </tr>
                </thead>
                <tbody id="leaderboard-body">
                    </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwJOy-G4lkbY2oSBAcAmAZch7-IPqGXE5AlY-RI48_ILZxipsX4tsoyO0msbvEvwa4/exec';

    const soalData = [
        { q: "Arti kata Oikonomia adalah ....", a: "Aturan negara", b: "Rumah Tangga", c: "Kegiatan manusia", d: "Aturan masyarakat", k: "b" },
        { q: "Kelangkaan terjadi karena ....", a: "Kebutuhan tak terbatas & alat terbatas", b: "Kebutuhan terbatas & alat tak terbatas", c: "Semua tidak terbatas", d: "Semua terbatas", k: "a" },
        { q: "Jam tangan mewah termasuk kebutuhan ....", a: "Primer", b: "Sekunder", c: "Tersier", d: "Pokok", k: "c" },
        { q: "Perbedaan konsumsi Erlin (Bakso) dan Suniah (Pempek) menunjukkan perbedaan....", a: "Pendapatan", b: "Harga", c: "Keinginan", d: "Selera", k: "d" },
        { q: "Pakaian nelayan tipis & orang gunung tebal. Ini karena perbedaan....", a: "Kedudukan", b: "Selera", c: "Pendidikan", d: "Lingkungan", k: "d" },
        { q: "Barang yang keberadaannya terbatas & perlu pengorbanan disebut...", a: "Substitusi", b: "Ekonomis", c: "Komplementer", d: "Bebas", k: "b" },
        { q: "Contoh barang bebas ditunjukkan nomor (Sinar Matahari/Udara) ....", a: "1 dan 2", b: "2 dan 3", c: "2 dan 4", d: "4 dan 5", k: "b" },
        { q: "Barang substitusi adalah ….", a: "Barang saling menggantikan", b: "Barang melengkapi", c: "Barang gratis", d: "Barang terbatas", k: "a" },
        { q: "Contoh barang komplementer adalah ….", a: "Teh dan kopi", b: "Bensin dan motor", c: "Air dan minyak", d: "Gas dan minyak", k: "b" },
        { q: "Pengertian ruang menurut konsep geografis adalah….", a: "Tempat di permukaan bumi untuk tinggal", b: "Gambaran peta", c: "Tempat di air", d: "Tempat berkembang biak", k: "a" },
        { q: "Ibu beralih ke pasar B karena jarak lebih dekat. Ini disebut...", a: "Transferability", b: "Connectivity", c: "Intervening Opportunity", d: "Complementary", k: "c" },
        { q: "Penduduk pantai sebagian besar bermata pencaharian sebagai….", a: "Nelayan", b: "Buruh tani", c: "Pedagang", d: "Pegawai", k: "a" },
        { q: "Contoh bentuk interaksi keruangan yaitu....", a: "Seseorang belanja ke kota", b: "Makan sushi", c: "Rumah beton", d: "Lahan jadi perumahan", k: "a" },
        { q: "Kondisi bergantung untuk interaksi keruangan, kecuali….", a: "Saling melengkapi", b: "Transfer Dana", c: "Kesempatan antara", d: "Kemudahan transfer", k: "b" },
        { q: "Komponen penyusun peta, kecuali…", a: "Judul", b: "Skala", c: "Legenda", d: "Garis pinggir", k: "d" },
        { q: "Wilayah A (Sayur) dan Wilayah B (Ikan) saling bertukar. Ini disebut....", a: "Transfer dana", b: "Saling melengkapi", c: "Kesempatan antara", d: "Kemudahan", k: "b" },
        { q: "Letak astronomis Indonesia adalah….", a: "6°LU–11°LS & 95°BT-141°BT", b: "6°LS–11°LS", c: "95°BB-141°BB", d: "6°LU–11°LS & 95°BB-141°BT", k: "a" },
        { q: "Hutan hujan tropis terluas di Indonesia adalah….", a: "Jawa", b: "Sumatera", c: "Sulawesi", d: "Kalimantan", k: "d" },
        { q: "Secara ekonomis terumbu karang bermanfaat sebagai ...", a: "Tujuan wisata", b: "Pelindung ikan", c: "Tempat makan ikan", d: "Berkembang biak", k: "a" },
        { q: "Gambar buku/alat tulis menunjukkan kebutuhan menurut ....", a: "Intensitasnya", b: "Sifatnya", c: "Waktunya", d: "Subjeknya", k: "a" }
    ];

    // Injek Soal ke HTML
    const quizDiv = document.getElementById('quiz-container');
    soalData.forEach((item, idx) => {
        quizDiv.innerHTML += `
            <div class="question-item">
                <span class="question-text">${idx+1}. ${item.q}</span>
                <div class="options-grid">
                    <label class="option-card"><input type="radio" name="q${idx}" value="a"> A. ${item.a}</label>
                    <label class="option-card"><input type="radio" name="q${idx}" value="b"> B. ${item.b}</label>
                    <label class="option-card"><input type="radio" name="q${idx}" value="c"> C. ${item.c}</label>
                    <label class="option-card"><input type="radio" name="q${idx}" value="d"> D. ${item.d}</label>
                </div>
            </div>
        `;
    });

    // Fungsi Ambil Data Papan Skor
    async function loadLeaderboard() {
        try {
            const res = await fetch(SCRIPT_URL);
            const data = await res.json();
            
            // Urutkan berdasarkan nilai tertinggi
            data.sort((a, b) => b.skor - a.skor);
            
            const tbody = document.getElementById('leaderboard-body');
            tbody.innerHTML = '';
            data.forEach((row, i) => {
                tbody.innerHTML += `
                    <tr>
                        <td class="rank">#${i + 1}</td>
                        <td><strong>${row.nama}</strong></td>
                        <td>${row.kelas}</td>
                        <td><span class="score-badge">${row.skor}</span></td>
                    </tr>
                `;
            });
            document.getElementById('loading-overlay').style.display = 'none';
        } catch (err) {
            document.getElementById('loading-overlay').innerText = "Gagal memuat data.";
        }
    }

    // Fungsi Kirim Jawaban
    async function submitExam() {
        const nama = document.getElementById('nama').value;
        const kelas = document.getElementById('kelas').value;
        const btn = document.getElementById('submit-btn');

        if(!nama || !kelas) {
            alert("⚠️ Masukkan Nama dan Kelas!");
            return;
        }

        btn.disabled = true;
        btn.innerText = "Mengirim Nilai...";

        let benar = 0;
        soalData.forEach((item, idx) => {
            const selected = document.querySelector(`input[name="q${idx}"]:checked`);
            if(selected && selected.value === item.k) benar++;
        });

        const skorFinal = (benar / soalData.length) * 100;

        try {
            // Kirim data ke Google Sheets
            await fetch(SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ nama, kelas, skor: skorFinal })
            });

            // Tampilkan hasil ke siswa
            document.getElementById('quiz-card').style.display = 'none';
            document.getElementById('result-section').style.display = 'block';
            document.getElementById('student-res-info').innerText = `${nama} - ${kelas}`;
            document.getElementById('final-score').innerText = skorFinal;

            // Refresh leaderboard
            loadLeaderboard();
        } catch (e) {
            alert("Error: " + e.message);
            btn.disabled = false;
        }
    }

    // Load data saat halaman dibuka
    window.onload = loadLeaderboard;
</script>

</body>
</html>