<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Quiz Matematika Kelas 7</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4f46e5;
            --secondary: #6366f1;
            --success: #10b981;
            --danger: #ef4444;
            --bg: #f8fafc;
            --text-dark: #1e293b;
            --card-bg: #ffffff;
        }

        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background-color: var(--bg); 
            color: var(--text-dark);
            margin: 0; padding: 20px;
            line-height: 1.6;
        }

        .container { max-width: 850px; margin: 0 auto; }

        .card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 25px -5px rgba(0,0,0,0.05);
            margin-bottom: 25px;
            border: 1px solid #e2e8f0;
        }

        h1 { text-align: center; color: var(--primary); font-size: 2rem; margin-bottom: 10px; }
        .subtitle { text-align: center; color: #64748b; margin-bottom: 30px; }

        .identity-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 20px;
            background: #f1f5f9; padding: 20px; border-radius: 12px; margin-bottom: 30px;
        }

        .input-group label { display: block; font-weight: 600; margin-bottom: 8px; font-size: 0.9rem; }
        input[type="text"] {
            width: 100%; padding: 12px; border: 1px solid #cbd5e1; border-radius: 8px;
            box-sizing: border-box; font-size: 1rem; transition: 0.3s;
        }
        input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1); }

        .question-item { margin-bottom: 30px; padding-bottom: 20px; border-bottom: 1px solid #f1f5f9; }
        .question-text { font-weight: 700; font-size: 1.05rem; display: block; margin-bottom: 15px; color: #334155; }
        
        .options-grid { display: grid; grid-template-columns: 1fr; gap: 10px; }
        .option-card {
            display: flex; align-items: center; padding: 12px 15px; border: 1.5px solid #e2e8f0;
            border-radius: 10px; cursor: pointer; transition: all 0.2s ease;
        }
        .option-card:hover { border-color: var(--primary); background: #f5f3ff; }
        input[type="radio"] { margin-right: 12px; width: 18px; height: 18px; accent-color: var(--primary); }

        .btn {
            background: var(--primary); color: white; border: none; padding: 16px;
            border-radius: 12px; width: 100%; font-size: 1.1rem; font-weight: 700;
            cursor: pointer; transition: 0.3s; margin-top: 10px;
        }
        .btn:hover { background: #4338ca; transform: translateY(-2px); }
        .btn:disabled { background: #94a3b8; cursor: not-allowed; }

        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { background: #f8fafc; text-align: left; padding: 12px; color: #64748b; font-size: 0.85rem; text-transform: uppercase; border-bottom: 2px solid #e2e8f0; }
        td { padding: 15px 12px; border-bottom: 1px solid #f1f5f9; font-size: 0.95rem; }
        .rank { font-weight: 700; color: var(--primary); }
        .score-badge { background: #dcfce7; color: #166534; padding: 4px 12px; border-radius: 99px; font-weight: 700; }

        #result-section { display: none; text-align: center; }
        .score-big { font-size: 4rem; font-weight: 800; color: var(--success); margin: 10px 0; }
        
        #loading-overlay { text-align: center; padding: 20px; color: var(--primary); font-weight: 600; }

        .img-question { max-width: 100%; height: auto; margin: 10px 0; border-radius: 8px; }

        @media (max-width: 600px) { .identity-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="container">
    <div class="card" id="quiz-card">
        <h1>Soal Matematika SMP Kelas 7</h1>
        <p class="subtitle">Bilangan Bulat, Pecahan, dan Himpunan</p>

        <div class="identity-grid">
            <div class="input-group">
                <label>Nama Lengkap</label>
                <input type="text" id="nama" placeholder="Masukkan nama...">
            </div>
            <div class="input-group">
                <label>Kelas</label>
                <input type="text" id="kelas" placeholder="VII - ...">
            </div>
        </div>

        <div id="quiz-container"></div>

        <button class="btn" id="submit-btn" onclick="submitExam()">Kirim Semua Jawaban</button>
    </div>

    <div class="card" id="result-section">
        <h2>Ujian Selesai!</h2>
        <p id="student-res-info"></p>
        <div class="score-big" id="final-score">0</div>
        <p style="color: #64748b;">Data Anda telah tersimpan di Google Sheets.</p>
        <button class="btn" onclick="location.reload()" style="background:#64748b;">Kerjakan Ulang</button>
    </div>

    <div class="card">
        <h2 style="margin-top:0;">Papan Skor Live (Real-time)</h2>
        <div id="loading-overlay">Menghubungkan ke database...</div>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Pos</th>
                        <th>Nama Siswa</th>
                        <th>Kelas</th>
                        <th>Nilai</th>
                    </tr>
                </thead>
                <tbody id="leaderboard-body"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzW9Qw0g-gfiCUisFkYslaY5zZX3LdIGvprAByAYf1EgW1X5gan3sPEJMBJB-nKNilw/exec';

    const soalData = [
    { 
        q: "Misalkan N(a,b,c) adalah banyaknya kelipatan a yang > b dan < c. Nilai dari N(6³, 6⁴, 6⁶) adalah....", 
        a: "216", b: "215", c: "209", d: "208", k: "b" 
    },
    { 
        q: "Gina mengisi tabel 3x3 dengan angka 1-9. Jika hasil kali baris adalah (96, N, 84) dan hasil kali kolom adalah (45, 24, 144/105), maka nilai N adalah....", 
        a: "1", b: "3", c: "4", d: "6", k: "d" 
    },
    { 
        q: "Bilangan 4, 5, 6, 9, 11, 12, 18, 20, 24 disusun selang-seling (Persegi-Lingkaran). Jika bilangan di lingkaran adalah jumlah tetangganya, bilangan pada lingkaran ke-2 adalah....", 
        a: "11", b: "12", c: "18", d: "20", k: "c" 
    },
    { 
        q: "Lima titik A, B, C, D, E berada pada garis lurus. Jarak AB=2, BC=3, CD=4, DE=5. Berapa jarak terkecil yang mungkin antara A dan E?", 
        a: "0", b: "2", c: "4", d: "6", k: "b" 
    },
    { 
        q: "Misalkan x, y, z adalah bilangan bulat positif. Jika x + y + z = 12 dan x < y < z, maka banyaknya solusi (x, y, z) adalah....", 
        a: "5", b: "7", c: "8", d: "12", k: "b" 
    },
    { 
        q: "Berapakah sisa pembagian dari bilangan 2²⁰²⁴ + 3²⁰²⁴ jika dibagi oleh 5?", 
        a: "0", b: "1", c: "2", d: "3", k: "c" 
    },
    { 
        q: "Misalkan n adalah bilangan bulat positif terkecil yang memiliki tepat 12 pembagi positif. Nilai n adalah....", 
        a: "60", b: "72", c: "84", d: "96", k: "a" 
    },
    { 
        q: "Jika f(x) = ax + b, f(1) = 5, dan f(f(f(1))) = 29, maka nilai dari a + b adalah....", 
        a: "5", b: "6", c: "7", d: "8", k: "a" 
    },
    { 
        q: "Berapa banyak bilangan bulat n sehingga (n + 3) dapat membagi habis (n² + 7)?", 
        a: "4", b: "6", c: "8", d: "10", k: "c" 
    },
    { 
        q: "Sebuah kotak berisi 5 bola merah dan 5 bola putih. Diambil 3 bola sekaligus. Peluang terambilnya minimal 2 bola merah adalah....", 
        a: "1/2", b: "5/12", c: "7/12", d: "2/3", k: "a" 
    },
    { 
        q: "Jika g(x) = x² - 2x + 1, maka nilai dari g(g(g(2))) adalah....", 
        a: "1", b: "2", c: "4", d: "16", k: "a" 
    },
    { 
        q: "Diketahui segitiga ABC dengan panjang sisi AB=6, BC=8, AC=10. Jarak dari titik B ke garis AC adalah....", 
        a: "4.2", b: "4.8", c: "5.0", d: "5.2", k: "b" 
    },
    { 
        q: "Jumlah semua bilangan ratusan yang ketiga digitnya berbeda dan tidak memuat angka 0 adalah....", 
        a: "359.640", b: "279.720", c: "277.200", d: "252.000", k: "b" 
    },
    { 
        q: "Banyaknya cara menyusun 10 persegi panjang kecil (1x2) menjadi satu persegi panjang besar (10x2) adalah....", 
        a: "78", b: "89", c: "144", d: "233", k: "b" 
    },
    { 
        q: "Peluang Anthony Ginting menang tiap set adalah 0.6. Pertandingan berakhir jika salah satu menang 2 set. Peluang Ginting menang pertandingan adalah....", 
        a: "0.648", b: "0.652", c: "0.720", d: "0.744", k: "a" 
    },
    { 
        q: "Diberikan x dan y bilangan real yang memenuhi x² + y² = 4. Nilai maksimum dari 3x + 4y adalah....", 
        a: "5", b: "10", c: "12", d: "14", k: "b" 
    },
    { 
        q: "Berapa banyak angka 0 berurutan di akhir dari hasil perkalian 1 x 2 x 3 x ... x 50 (50!)?", 
        a: "10", b: "12", c: "14", d: "15", k: "b" 
    },
    { 
        q: "Jika log(x) + log(x²) = 6, maka nilai x adalah....", 
        a: "10", b: "100", c: "1000", d: "10000", k: "b" 
    },
    { 
        q: "Sebuah dadu dilempar dua kali. Peluang jumlah mata dadu yang muncul habis dibagi 4 adalah....", 
        a: "1/4", b: "1/6", c: "1/9", d: "1/12", k: "a" 
    },
    { 
        q: "Rata-rata dari 5 bilangan adalah 10. Jika satu bilangan diganti angka 15, rata-ratanya menjadi 12. Bilangan yang diganti adalah....", 
        a: "3", b: "5", c: "7", d: "10", k: "b" 
    }
];

    // Injek Soal ke HTML
    const quizDiv = document.getElementById('quiz-container');
    soalData.forEach((item, idx) => {
        quizDiv.innerHTML += `
            <div class="question-item">
                <span class="question-text">${idx+1}. ${item.q}</span>
                <div class="options-grid">
                    <label class="option-card"><input type="radio" name="q${idx}" value="a"> A. ${item.a}</label>
                    <label class="option-card"><input type="radio" name="q${idx}" value="b"> B. ${item.b}</label>
                    <label class="option-card"><input type="radio" name="q${idx}" value="c"> C. ${item.c}</label>
                    <label class="option-card"><input type="radio" name="q${idx}" value="d"> D. ${item.d}</label>
                </div>
            </div>
        `;
    });

    async function loadLeaderboard() {
        try {
            const res = await fetch(SCRIPT_URL);
            const data = await res.json();
            data.sort((a, b) => b.skor - a.skor);
            const tbody = document.getElementById('leaderboard-body');
            tbody.innerHTML = '';
            data.forEach((row, i) => {
                tbody.innerHTML += `
                    <tr>
                        <td class="rank">#${i + 1}</td>
                        <td><strong>${row.nama}</strong></td>
                        <td>${row.kelas}</td>
                        <td><span class="score-badge">${row.skor}</span></td>
                    </tr>
                `;
            });
            document.getElementById('loading-overlay').style.display = 'none';
        } catch (err) {
            document.getElementById('loading-overlay').innerText = "Gagal memuat data.";
        }
    }

    async function submitExam() {
        const nama = document.getElementById('nama').value;
        const kelas = document.getElementById('kelas').value;
        const btn = document.getElementById('submit-btn');

        if(!nama || !kelas) {
            alert("⚠️ Masukkan Nama dan Kelas!");
            return;
        }

        btn.disabled = true;
        btn.innerText = "Mengirim Nilai...";

        let benar = 0;
        soalData.forEach((item, idx) => {
            const selected = document.querySelector(`input[name="q${idx}"]:checked`);
            if(selected && selected.value === item.k) benar++;
        });

        const skorFinal = Math.round((benar / soalData.length) * 100);

        try {
            await fetch(SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ nama, kelas, skor: skorFinal })
            });

            document.getElementById('quiz-card').style.display = 'none';
            document.getElementById('result-section').style.display = 'block';
            document.getElementById('student-res-info').innerText = `${nama} - ${kelas}`;
            document.getElementById('final-score').innerText = skorFinal;
            loadLeaderboard();
        } catch (e) {
            alert("Error: " + e.message);
            btn.disabled = false;
        }
    }

    window.onload = loadLeaderboard;
</script>

</body>
</html>
